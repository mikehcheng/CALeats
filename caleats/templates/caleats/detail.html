{% extends "caleats/base.html" %}
{% load staticfiles %}

{% block title %}{{ hall }}{% endblock title %}

{% block middle %}
<div class="container">
  	<div class="jumbotron" id="hallheader">
        <h1>{{ hall }}</h1>
        <h2> dinner | 5:00 pm - 10:00 pm</h2>
    </div>
</div>

<script type="text/javascript" src="{% static 'caleats/js/jquery.js' %}"></script>
<script>
    function vote(kind, id) {
        $.getJSON("/caleats/vote/", { pk: id, vote: kind }, function(json){
            if (json['success'])
            {
                var votes = document.getElementById(id+"votes");
                var uvote = document.getElementById(id+"uvote");
                var dvote = document.getElementById(id+"dvote");
                if (kind=="up")
                {
                    newvotes=parseInt(votes.innerHTML)+1
                    if(json['prevvoted'])
                    {
                        newvotes+=1
                    }
                    votes.innerHTML=newvotes
                    uvote.className="upvote vselected"
                    dvote.className="downvote"
                }
                else
                {
                    newvotes=parseInt(votes.innerHTML)-1
                    if(json['prevvoted'])
                    {
                        newvotes-=1
                    }
                    votes.innerHTML=newvotes
                    uvote.className="upvote"
                    dvote.className="downvote vselected"
                }
            }
        });
    }
    function favorite(id, elem) {
        {% if user %}
        $.get("/caleats/favorite/", { pk: id });
        if (elem.className=="rh heart")
        {
            elem.className="gh heart"
        }
        else
        {
            elem.className="rh heart"
        }
        {% endif %}
    }
    function addClickHandlers() {
        $(".upvote").click( function() { vote("up", $(this).attr("pk")) });
        $(".downvote").click( function() { vote("down", $(this).attr("pk")) });
        $(".heart").click( function() { favorite($(this).attr("pk"), this);
                                        
                                      });
    }
    $(document).ready(addClickHandlers);
</script>

<div class="container">
    <div id="mealdisplay">
        <ul id="MealChoice" class="nav nav-tabs">
          <li class="active"><a href="#breakfast" data-toggle="tab">Breakfast</a></li>
          <li><a href="#lunch" data-toggle="tab">Lunch</a></li>
          <li><a href="#dinner" data-toggle="tab">Dinner</a></li>
        </ul>
        <div id="Menu" class="tab-content">
          <div class="tab-pane fade in active" id="breakfast">
            <table class="table table-striped">
                {% for mu in br_menuitems %}
                <tr>
                    <td>{{ mu.entree.votes }}</td>
                    <td>{{ mu.entree.name }}</td>
                    <td><span class="upvote" pk="{{ mu.pk }}">+</span> / <span class="downvote"  pk="{{ mu.pk }}">-</span></td>
                    <td><span class={% if mu.entree in favorites %}"rh heart"{%  else %}"gh heart"{% endif %} pk="{{ mu.pk }}">&lt3</span></td>
                </tr>
                {% empty %}
                    <tr>
                        <td><em>Closed</em></td>
                    </tr>
                {% endfor %}
            </table>
          </div>
          <div class="tab-pane fade" id="lunch">
            <table class="table table-striped">
                {% for mu in lu_menuitems %}
                <tr>
                    <td id="{{ mu.pk }}votes">{{ mu.entree.votes }}</td>
                    <td>{{ mu.entree.name }}</td>
                    <td>
                        <span id="{{ mu.pk }}uvote" class="upvote{% if mu.entree in upvotes %} vselected{% endif %}" pk="{{ mu.pk }}">+</span> / 
                        <span id="{{ mu.pk }}dvote" class="downvote{% if mu.entree in downvotes %} vselected{% endif %}"  pk="{{ mu.pk }}">-</span>
                    </td>
                    <td><span class="{% if mu.entree in favorites %}rh{%  else %}gh{% endif %} heart" pk="{{ mu.pk }}">&lt3</span></td>
                </tr>
                {% empty %}
                    <tr>
                        <td><em>Closed</em></td>
                    </tr>
                {% endfor %}
            </table>
          </div>
          <div class="tab-pane fade" id="dinner">
            <table class="table table-striped">
                {% for mu in di_menuitems %}
                <tr>
                    <td>{{ mu.entree.votes }}</td>
                    <td>{{ mu.entree.name }}</td>
                    <td><span class="upvote" pk="{{ mu.pk }}">+</span> / <span class="downvote"  pk="{{ mu.pk }}">-</span></td>
                    <td><span class={% if mu.entree in favorites %}"rh heart"{%  else %}"gh heart"{% endif %} pk="{{ mu.pk }}">&lt3</span></td>
                </tr>
                {% empty %}
                    <tr>
                        <td><em>Closed</em></td>
                    </tr>
                {% endfor %}
            </table>
          </div>        
        </div>
    </div>
</div>
{% endblock %}

